WITH MATERIALS AS (SELECT 
МатериалыРБМ.id AS id, 
МатериалыРБМ.НазваниеМтрПоГостОстТу AS НазваниеРБМ, 
'#' || МатериалыРБМ.НазваниеМтрПоГостОстТу || '#' || МатериалыРБМ.КодМтрПоСпецификацииИндексЧертеж || '#' AS Измерение, 
'РФ' AS СтранаИзготовитель, 
ПоставщикиМатериаловРБМ.ПоставвщикИсх AS Поставщик, 
ПоставщикиМатериаловРБМ.Поставвщик.id AS ПоставвщикID 
FROM Справочники.МатериалыРБМ AS МатериалыРБМ 
LEFT JOIN Справочники.ПоставщикиМатериаловРБМ AS ПоставщикиМатериаловРБМ 
ON ПоставщикиМатериаловРБМ.УуидРодительскойЗаписи = МатериалыРБМ.uuid 
 
UNION 
 
SELECT 
МатериалыРБМИмпорт.id AS id, 
МатериалыРБМИмпорт.НазваниеМтрПоГостОстТу AS НазваниеРБМ, 
'#' || МатериалыРБМИмпорт.НазваниеМтрПоГостОстТу || '#' || МатериалыРБМИмпорт.КодМтрПоСпецификацииИндексЧертеж || '#' AS Измерение, 
ПоставщикиМатериаловРбмИмпорт.СтранаИзготовителяИсх AS СтранаИзготовитель, 
ПоставщикиМатериаловРбмИмпорт.НазваниеИзготовителяПоставщика AS Поставщик, 
0 AS ПоставвщикID 
FROM Справочники.РесурсыРБМИмпорт AS МатериалыРБМИмпорт 
LEFT JOIN Справочники.ПоставщикиМатериаловРбмИмпорт AS ПоставщикиМатериаловРбмИмпорт 
ON ПоставщикиМатериаловРбмИмпорт.УуидРодительскойЗаписи = МатериалыРБМИмпорт.uuid 
 
ORDER BY НазваниеРБМ) 
 
SELECT 
DISTINCT(MATERIALS.id) AS id, 
MATERIALS.НазваниеРБМ AS НазваниеРБМ, 
MATERIALS.Измерение AS Измерение, 
MATERIALS.Поставщик AS Поставщик, 
Расчеты.РезультатРасчетов AS РезультатРасчетов, 
Расчеты.Теги AS Теги 
FROM MATERIALS AS MATERIALS 
LEFT JOIN Справочники.Расчеты.РезультатыРасчетов AS Расчеты 
ON MATERIALS.Измерение = Расчеты.Теги 
WHERE 
Расчеты.Ссылка.Аббревиатура = 'ВХОЖДЕНИЕ-МТР-В-ФИ'
